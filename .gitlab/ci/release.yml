docs:
  artifacts:
    paths:
      - public
      - docs/changelog.md
      - release-notes.md
  only:
    - /^v?(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)(-?(a|b|rc)(0|[1-9][0-9]*)?)?$/
  script:
    - env | sort
    - make dev-docs
    - make docs
    - make release-notes > release-notes.md
  stage: release
package:
  needs:
    - release
  only:
    - /^v?(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)(-?(a|b|rc)(0|[1-9][0-9]*)?)?$/
  script:
    - env | sort
    - make dev-package
    - make build
    - make upload
  stage: release
  variables:
    TWINE_NON_INTERACTIVE: 'true'
pages:
  artifacts:
    paths:
      - public
  needs:
    - release
    - docs
  only:
    - /^v?(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)(-?(a|b|rc)(0|[1-9][0-9]*)?)?$/
  script:
    - env | sort
  stage: release
release:
  image: registry.gitlab.com/gitlab-org/release-cli:latest
  needs:
    - docs
  only:
    - /^v?(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)(-?(a|b|rc)(0|[1-9][0-9]*)?)?$/
  release:
    description: release-notes.md
    tag_name: $CI_COMMIT_TAG
  script:
    - env | sort
  stage: release
